
<html> 
<!-- 
This used Skulpt a neat in-browser implementation of Python. http://www.skulpt.org/

todo: 
break up into seperate css, js, and py files (but for now keep it together for easy editting)
make pretty
make it able to do symbolic calculations (note: skulpt is python v. 2.6 and eval is not supported)

-->
<head> 
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.0/jquery.min.js" type="text/javascript"></script> 
<script src="skulpt.min.js" type="text/javascript"></script> 
<script src="skulpt-stdlib.js" type="text/javascript"></script> 

<style>
	table{
		text-align: right;
	}
	
	td{
		padding-right: 20px;
		overflow:hidden;
		text-overflow: ellipsis;
		white-space: nowrap;
	}
	
	textarea{
		border:none; 
		overflow:hidden; 
		resize:none;
	}
	
	div{
		font-size: 15px;
	}
</style>

</head> 

<body> 
<h3>Numerical Routh-Hurwitz Criterion Calculator</h3> 

<textarea id="input" cols="60" rows="3">
coefficients = [1,12,4,2,8]
significant_figures = 4
approximate_mode = True</textarea>
<br/> 

<pre id="output" ></pre> 


<div>
<b>About:</b> <br>
Enter coefficients as decimals in descending order of s. <br>
This program approximates
<sup>&plusmn;1</sup>&frasl;<sub>0</sub> = &plusmn;10<sup>100</sup>, 
<sup>0</sup>&frasl;<sub>0</sub> = 1, and 0 = 10<sup>&#8722;100</sup>. <br>
To see why approximate mode is important, compare modes with [1,3,2,0,0]

</div>

<!-- we put the python code in a textarea, but don't display it -->
<textarea id="python_code" style="display:none">
# convert everything to floats
coefficients = [float(i) for i in coefficients]
n = len(coefficients) - 1
r = []

# this program will do the routh-hurwitz of any 
# order polynomial if you add more padding. 
# We give enough for order 40 which should be plenty 
padding = [0]*20

# show the user the polynomial
s = [str(a) + "s<sup>" + str(i) + "</sup>" for i, a in enumerate(coefficients[::-1])]
print "characteristic equation: " + " + ".join(s[::-1]) + "\n"

# create the top two rows
r.append(coefficients[::2] + padding)
r.append(coefficients[1::2] + padding)

# implement the algorithm here: 
# http://en.wikipedia.org/wiki/Routh%E2%80%93Hurwitz_stability_criterion#Higher-order_example
for j in range(2, len(coefficients)):
    row = []
    for i in range(n):
        numerator = (r[j-1][0]*r[j-2][i+1])-(r[j-2][0]*r[j-1][i+1])
        denominator = r[j-1][0]

        # avoid dividing by zero
        if denominator == 0:
            if numerator > 0:   result = 10**100
            elif numerator < 0: result = -(10**100)
            else:               result = 1
        else:
            result = numerator/denominator
            if result == 0 and approximate_mode == True: 
				result = 10**(-100)
                
        row.append(result)
    r.append(row + padding)

	
# print the created routh-hurwitz table
table = "<table>"
for row in r:
	table += "<tr>"
	for i in range(n):
		result = "%s" % float( ("%." + str(significant_figures) + "g") % row[i])
		if i == 0: result = "<b>" + result + "</b>"
		table += "<td>" + result + "</td>" 
	table += "</tr>"
print table + "</table>"

</textarea>



</body>

<script type="text/javascript"> 

	$(document).ready(function() {
		execute_python();
	});

	//perpetually update the output when changes are made
	$('textarea').on('change keydown keypress keyup load mousemove', function(){
		execute_python();
	});

	// executes python code in "input" and "python_code" using skulpt
	function execute_python() { 
	   var prog = document.getElementById("input").value; 
	   prog += "\n" + document.getElementById("python_code").value;
	   
	   var mypre = document.getElementById("output"); 
	   mypre.innerHTML = ''; 
	   Sk.pre = "output";
	   Sk.configure({output:outf, read:builtinRead}); 
	   try {
		  eval(Sk.importMainWithBody("<stdin>",false,prog)); 
	   }
	   catch(e) {
			var mypre = document.getElementById("output"); 
			mypre.innerHTML = mypre.innerHTML + e.toString();        
		}
	}

	function outf(text) {
		var mypre = document.getElementById("output"); 
		mypre.innerHTML = mypre.innerHTML + text; 
	}

	function builtinRead(x) {
		if (Sk.builtinFiles === undefined || Sk.builtinFiles["files"][x] === undefined)
				throw "File not found: '" + x + "'";
		return Sk.builtinFiles["files"][x];
	}


</script> 


</html> 
